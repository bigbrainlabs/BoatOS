# TileServer proxy configuration for nginx
# Add this to the existing server block in nginx config

location /tiles/ {
    proxy_pass http://localhost:8081/;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;

    # CORS headers for map tiles
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods 'GET, OPTIONS';
    add_header Access-Control-Allow-Headers 'Range';

    # Cache tiles for better performance
    proxy_cache_valid 200 30d;
    proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
}

# Serve fonts directly
location /fonts/ {
    proxy_pass http://localhost:8081/fonts/;
    add_header Access-Control-Allow-Origin *;
}

# Serve styles directly
location /styles/ {
    proxy_pass http://localhost:8081/styles/;
    add_header Access-Control-Allow-Origin *;
}

# Serve data (TileJSON)
location /data/ {
    proxy_pass http://localhost:8081/data/;
    add_header Access-Control-Allow-Origin *;
}
