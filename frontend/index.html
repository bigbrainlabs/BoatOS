<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>BoatOS - Navigation</title>

    <!-- MapLibre GL JS (lokal) -->
    <link rel="stylesheet" href="lib/maplibre-gl.css" />
    <script src="lib/maplibre-gl.js"></script>

    <!-- BoatOS Styles -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- ============================================
         TOP BAR
         ============================================ -->
    <div class="top-bar">
        <div class="top-bar-section">
            <div class="gps-indicator no-fix" id="gpsIndicator" onclick="BoatOS.ui.toggleGpsPopup()">
                <div class="gps-dot"></div>
                <span id="gps-sats">-- Sats</span>
            </div>
        </div>

        <div class="nav-values">
            <div class="nav-value">
                <div class="value" id="sog-value">0.0</div>
                <div class="label" id="sog-label">SOG kn</div>
            </div>
            <div class="nav-value">
                <div class="value" id="cog-value">---¬∞</div>
                <div class="label">COG</div>
            </div>
            <div class="nav-value">
                <div class="value" id="dist-value">--</div>
                <div class="label" id="dist-label">NM</div>
            </div>
            <div class="nav-value">
                <div class="value" id="eta-value">--:--</div>
                <div class="label">ETA</div>
            </div>
        </div>

        <div class="top-bar-right">
            <button class="icon-btn" id="trackBtn" onclick="BoatOS.sensors.toggleTrack()" title="Track">‚è∫Ô∏è</button>
            <button class="icon-btn" id="themeToggle" onclick="BoatOS.theme.toggleTheme()" title="Dark Mode">üåô</button>
            <button class="icon-btn" id="modeToggle" onclick="BoatOS.ui.toggleMode()" title="Karte">üó∫Ô∏è</button>
            <button class="icon-btn" id="dashboardEditBtn" onclick="BoatOS.openDashboardEditor()" title="Dashboard bearbeiten">‚úèÔ∏è</button>
            <button class="icon-btn" onclick="BoatOS.ui.toggleSidebar()" title="Einstellungen">‚öôÔ∏è</button>
        </div>
    </div>

    <!-- GPS Popup -->
    <div class="gps-popup" id="gpsPopup">
        <h4>üìç GPS Details</h4>
        <div class="gps-detail-row">
            <span class="gps-detail-label">Satelliten</span>
            <span class="gps-detail-value" id="gps-satellites">-- / --</span>
        </div>
        <div class="gps-detail-row">
            <span class="gps-detail-label">Fix</span>
            <span class="gps-detail-value" id="gps-fix-status">Kein Fix</span>
        </div>
        <div class="gps-detail-row">
            <span class="gps-detail-label">Position</span>
            <span class="gps-detail-value" id="gps-position">--</span>
        </div>
        <div class="gps-detail-row">
            <span class="gps-detail-label">H√∂he</span>
            <span class="gps-detail-value" id="gps-altitude">-- m</span>
        </div>
        <div class="gps-detail-row">
            <span class="gps-detail-label">HDOP</span>
            <span class="gps-detail-value" id="gps-hdop">--</span>
        </div>
    </div>

    <!-- ============================================
         MAP / DASHBOARD
         ============================================ -->
    <div class="map-container hidden" id="mapContainer">
        <div id="map"></div>
    </div>

    <div class="dashboard-container active" id="dashboardContainer">
        <!-- Dynamic dashboard rendered from saved configuration -->
        <div id="sensor-dashboard" style="padding: 10px;">
            <!-- Loading indicator -->
            <div style="text-align: center; padding: 40px; color: var(--text-dim);">
                <div style="font-size: 32px; margin-bottom: 10px;">üìä</div>
                Dashboard wird geladen...
            </div>
        </div>
    </div>

    <!-- ============================================
         FLOATING ACTION BUTTONS
         ============================================ -->
    <div class="fab-container" id="fabContainer">
        <button class="fab" onclick="BoatOS.map.centerOnBoat()" title="Zentrieren">üéØ</button>
        <button class="fab" onclick="BoatOS.map.zoomIn()" title="Zoom +">+</button>
        <button class="fab" onclick="BoatOS.map.zoomOut()" title="Zoom -">‚àí</button>
        <button class="fab" onclick="BoatOS.ui.toggleLayers()" title="Layer">üóÇÔ∏è</button>
        <button class="fab danger" onclick="BoatOS.core.manOverBoard()" title="MOB">üÜò</button>
    </div>

    <!-- ============================================
         BOTTOM SHEET
         ============================================ -->
    <div class="bottom-sheet peek" id="bottomSheet">
        <div class="sheet-handle" onclick="BoatOS.ui.cycleSheet()">
            <div class="sheet-handle-bar"></div>
        </div>

        <div class="quick-actions">
            <div class="quick-action" data-mode="route" onclick="BoatOS.navigation.startRoutePlanning()">
                <span class="icon">üß≠</span>
                <span class="label">Route</span>
            </div>
            <div class="quick-action" data-mode="poi" onclick="BoatOS.navigation.startPoiPlacement()">
                <span class="icon">üìç</span>
                <span class="label">POI</span>
            </div>
            <div class="quick-action" onclick="BoatOS.ui.openSearch()">
                <span class="icon">üîç</span>
                <span class="label">Suche</span>
            </div>
            <div class="quick-action" onclick="BoatOS.ui.showFavorites()">
                <span class="icon">‚≠ê</span>
                <span class="label">Favoriten</span>
            </div>
            <div class="quick-action" onclick="BoatOS.ais.showAISPanel()">
                <span class="icon">üö¢</span>
                <span class="label">AIS</span>
            </div>
            <div class="quick-action" id="btn-locks" onclick="BoatOS.ui.toggleLocks()">
                <span class="icon">üöß</span>
                <span class="label">Schleusen</span>
            </div>
            <div class="quick-action" id="btn-pegel" onclick="BoatOS.ui.togglePegel()">
                <span class="icon">üìä</span>
                <span class="label">Pegel</span>
            </div>
        </div>

        <div class="sheet-tabs">
            <div class="sheet-tab active" onclick="BoatOS.ui.showSection('route', this)">Route</div>
            <div class="sheet-tab" onclick="BoatOS.ui.showSection('weather', this)">Wetter</div>
            <div class="sheet-tab" onclick="BoatOS.ui.showSection('logbook', this)">Logbuch</div>
            <div class="sheet-tab" onclick="BoatOS.ui.showSection('ais', this)">AIS</div>
            <div class="sheet-tab" onclick="BoatOS.ui.showSection('locks', this)">Schleusen</div>
        </div>

        <div class="sheet-content">
            <!-- ROUTE SECTION -->
            <div id="section-route">
                <div class="route-header">
                    <span style="font-size: 16px; font-weight: 600;">Aktuelle Route</span>
                    <div style="display: flex; gap: 8px;">
                        <button class="icon-btn" id="btn-start-nav" style="width: 36px; height: 36px; font-size: 18px; background: var(--success); color: white;" onclick="BoatOS.toggleNavigation()" title="Navigation starten">‚ñ∂Ô∏è</button>
                        <button class="icon-btn" style="width: 32px; height: 32px; font-size: 14px;" onclick="BoatOS.editRoute()" title="Route bearbeiten">‚úèÔ∏è</button>
                        <button class="icon-btn" style="width: 32px; height: 32px; font-size: 14px;" onclick="BoatOS.clearRoute()" title="Route l√∂schen">üóëÔ∏è</button>
                    </div>
                </div>

                <div class="route-summary">
                    <div class="route-stat">
                        <div class="value" id="route-distance">--</div>
                        <div class="label">NM</div>
                    </div>
                    <div class="route-stat">
                        <div class="value" id="route-time">--:--</div>
                        <div class="label">Zeit</div>
                    </div>
                    <div class="route-stat">
                        <div class="value" id="route-locks">0</div>
                        <div class="label">Schleusen</div>
                    </div>
                    <div class="route-stat">
                        <div class="value" id="route-eta">--:--</div>
                        <div class="label">ETA</div>
                    </div>
                </div>

                <div class="waypoint-list" id="waypointList">
                    <div style="text-align: center; padding: 20px; color: var(--text-dim);">
                        Keine Route geplant.<br>
                        <small>Klicke auf die Karte um Wegpunkte hinzuzuf√ºgen.</small>
                    </div>
                </div>
            </div>

            <!-- WEATHER SECTION -->
            <div id="section-weather" class="section-hidden">
                <div class="weather-current">
                    <div class="weather-icon" id="weather-icon">üå§Ô∏è</div>
                    <div class="weather-main">
                        <div class="weather-temp" id="weather-temp">--¬∞C</div>
                        <div class="weather-desc" id="weather-desc">Laden...</div>
                        <div class="weather-location" id="weather-location">üìç --</div>
                    </div>
                </div>

                <div class="weather-details">
                    <div class="weather-detail">
                        <div class="icon">üí®</div>
                        <div class="value" id="weather-wind">--</div>
                        <div class="label" id="weather-wind-label">Wind (kn)</div>
                    </div>
                    <div class="weather-detail">
                        <div class="icon">üß≠</div>
                        <div class="value" id="weather-wind-dir">--</div>
                        <div class="label">Richtung</div>
                    </div>
                    <div class="weather-detail">
                        <div class="icon">üíß</div>
                        <div class="value" id="weather-humidity">--%</div>
                        <div class="label">Feuchte</div>
                    </div>
                    <div class="weather-detail">
                        <div class="icon">üìä</div>
                        <div class="value" id="weather-pressure">--</div>
                        <div class="label">hPa</div>
                    </div>
                </div>

                <div class="forecast-title">Vorhersage</div>
                <div class="forecast-list" id="forecast-list">
                    <!-- Forecast items loaded dynamically -->
                </div>
            </div>

            <!-- LOGBOOK SECTION -->
            <div id="section-logbook" class="section-hidden">
                <div class="logbook-tabs">
                    <div class="logbook-tab active" onclick="BoatOS.showLogbookTab('current', this)">Aktuelle Fahrt</div>
                    <div class="logbook-tab" onclick="BoatOS.showLogbookTab('archive', this)">Archiv</div>
                </div>

                <!-- AKTUELLE FAHRT TAB -->
                <div class="logbook-tab-content active" id="logbook-tab-current">
                    <div class="current-trip" id="currentTrip">
                        <!-- Recording Indicator -->
                        <div id="recording-indicator-new" style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); border-radius: 12px; padding: 10px; margin-bottom: 12px; display: none; align-items: center; gap: 10px;">
                            <div style="width: 12px; height: 12px; background: var(--danger); border-radius: 50%; animation: pulse 1.5s infinite;"></div>
                            <span style="color: var(--danger); font-weight: 600;">Aufzeichnung l√§uft</span>
                            <span id="trip-duration" style="margin-left: auto; font-variant-numeric: tabular-nums;">00:00:00</span>
                        </div>

                        <div class="trip-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <div>
                                <div class="trip-title" id="trip-title" style="font-size: 16px; font-weight: 600;">Keine aktive Fahrt</div>
                                <div class="trip-status" id="trip-status" style="font-size: 12px; color: var(--text-dim);">Bereit zum Starten</div>
                            </div>
                            <div id="trip-paused-badge" style="display: none; background: var(--warning); color: white; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600;">
                                ‚è∏Ô∏è PAUSIERT
                            </div>
                        </div>

                        <!-- Track Stats -->
                        <div class="trip-stats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px;">
                            <div class="trip-stat" style="background: var(--bg-card); padding: 12px; border-radius: 12px; text-align: center;">
                                <div class="value" id="trip-points" style="font-size: 20px; font-weight: 700; color: var(--accent);">0</div>
                                <div class="label" style="font-size: 10px; color: var(--text-dim);">Punkte</div>
                            </div>
                            <div class="trip-stat" style="background: var(--bg-card); padding: 12px; border-radius: 12px; text-align: center;">
                                <div class="value" id="trip-distance" style="font-size: 20px; font-weight: 700; color: var(--accent);">--</div>
                                <div class="label" id="trip-dist-label" style="font-size: 10px; color: var(--text-dim);">NM</div>
                            </div>
                            <div class="trip-stat" style="background: var(--bg-card); padding: 12px; border-radius: 12px; text-align: center;">
                                <div class="value" id="trip-time" style="font-size: 20px; font-weight: 700; color: var(--accent);">--:--</div>
                                <div class="label" style="font-size: 10px; color: var(--text-dim);">Dauer</div>
                            </div>
                            <div class="trip-stat" style="background: var(--bg-card); padding: 12px; border-radius: 12px; text-align: center;">
                                <div class="value" id="trip-avg-speed" style="font-size: 20px; font-weight: 700; color: var(--accent);">--</div>
                                <div class="label" id="trip-speed-label" style="font-size: 10px; color: var(--text-dim);">√ò kn</div>
                            </div>
                        </div>

                        <!-- Control Buttons -->
                        <div class="trip-controls" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <!-- Start Button (shown when not recording) -->
                            <button id="btn-start-trip" onclick="BoatOS.startTrip()" style="flex: 1; min-width: 120px; padding: 14px; border: none; border-radius: 12px; background: var(--success); color: white; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                üö¢ Fahrt starten
                            </button>

                            <!-- Stop Button (shown when recording) -->
                            <button id="btn-stop-trip" onclick="BoatOS.stopTrip()" style="flex: 1; min-width: 120px; padding: 14px; border: none; border-radius: 12px; background: var(--danger); color: white; font-size: 14px; font-weight: 600; cursor: pointer; display: none; align-items: center; justify-content: center; gap: 8px;">
                                ‚öì Beenden
                            </button>

                            <!-- Pause Button (shown when recording and not paused) -->
                            <button id="btn-pause-trip" onclick="BoatOS.pauseTrip()" style="padding: 14px 18px; border: none; border-radius: 12px; background: var(--warning); color: white; font-size: 14px; font-weight: 600; cursor: pointer; display: none; align-items: center; justify-content: center; gap: 6px;" title="Pause / Ankern">
                                ‚è∏Ô∏è Pause
                            </button>

                            <!-- Resume Button (shown when paused) -->
                            <button id="btn-resume-trip" onclick="BoatOS.resumeTrip()" style="padding: 14px 18px; border: none; border-radius: 12px; background: var(--success); color: white; font-size: 14px; font-weight: 600; cursor: pointer; display: none; align-items: center; justify-content: center; gap: 6px;" title="Weiterfahren">
                                ‚ñ∂Ô∏è Weiter
                            </button>

                            <!-- Add Entry Button (always visible) -->
                            <button id="btn-add-entry" onclick="BoatOS.addLogEntry()" style="padding: 14px 18px; border: none; border-radius: 12px; background: var(--bg-card); color: var(--accent); font-size: 14px; cursor: pointer; border: 1px solid var(--border);" title="Notiz hinzuf√ºgen">
                                üìù
                            </button>
                        </div>
                    </div>

                    <!-- Recent Log Entries -->
                    <div style="margin-top: 15px;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 10px; color: var(--text);">Letzte Eintr√§ge</div>
                        <div class="log-entries" id="logEntries" style="max-height: 300px; overflow-y: auto;">
                            <div style="text-align: center; padding: 20px; color: var(--text-dim);">
                                Noch keine Eintr√§ge
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ARCHIV TAB -->
                <div class="logbook-tab-content" id="logbook-tab-archive" style="display: none;">
                    <div id="trips-list" style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="text-align: center; padding: 20px; color: var(--text-dim);">
                            Lade archivierte Fahrten...
                        </div>
                    </div>
                </div>
            </div>

            <!-- AIS SECTION -->
            <div id="section-ais" class="section-hidden">
                <div class="ais-list" id="aisList">
                    <div style="text-align: center; padding: 20px; color: var(--text-dim);">
                        Keine AIS-Ziele in Reichweite.
                    </div>
                </div>
            </div>

            <!-- LOCKS SECTION -->
            <div id="section-locks" class="section-hidden">
                <div class="lock-list" id="lockList">
                    <div style="text-align: center; padding: 20px; color: var(--text-dim);">
                        Schleusen werden geladen...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         MANUAL ENTRY MODAL
         ============================================ -->
    <div class="modal-overlay" id="manual-entry-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 3000; align-items: center; justify-content: center;" onclick="BoatOS.closeManualEntryModal()">
        <div class="modal-content" style="background: var(--bg-panel); border-radius: 20px; width: 90%; max-width: 400px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 18px; color: var(--accent);">üìù Logbuch-Eintrag</h3>
                <button onclick="BoatOS.closeManualEntryModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-dim);">‚úï</button>
            </div>
            <form id="manual-entry-form" onsubmit="event.preventDefault(); BoatOS.submitManualEntry();">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 13px; color: var(--text-dim); margin-bottom: 6px;">Notizen</label>
                    <textarea id="manual-entry-notes" placeholder="Was ist passiert? Beobachtungen, Ereignisse..." style="width: 100%; height: 120px; padding: 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--bg-card); color: var(--text); font-size: 14px; resize: none;"></textarea>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="manual-entry-weather" checked style="width: 20px; height: 20px; accent-color: var(--accent);">
                        <span style="font-size: 14px;">üå§Ô∏è Aktuelle Wetterdaten anh√§ngen</span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="button" onclick="BoatOS.closeManualEntryModal()" style="flex: 1; padding: 14px; border: 1px solid var(--border); border-radius: 12px; background: var(--bg-card); color: var(--text); font-size: 14px; cursor: pointer;">
                        Abbrechen
                    </button>
                    <button type="submit" style="flex: 1; padding: 14px; border: none; border-radius: 12px; background: var(--accent); color: white; font-size: 14px; font-weight: 600; cursor: pointer;">
                        Speichern
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================
         CREW SELECTION MODAL
         ============================================ -->
    <div class="modal-overlay" id="crew-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 3000; align-items: center; justify-content: center;" onclick="BoatOS.closeCrewModal()">
        <div class="modal-content" style="background: var(--bg-panel); border-radius: 20px; width: 90%; max-width: 400px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 18px; color: var(--accent);">üë• Crew ausw√§hlen</h3>
                <button onclick="BoatOS.closeCrewModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-dim);">‚úï</button>
            </div>
            <p style="color: var(--text-dim); margin-bottom: 15px; font-size: 14px;">Wer ist bei dieser Fahrt dabei?</p>
            <div id="crew-list" style="max-height: 250px; overflow-y: auto; margin-bottom: 20px;">
                <!-- Crew members loaded dynamically -->
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="button" onclick="BoatOS.closeCrewModal()" style="flex: 1; padding: 14px; border: 1px solid var(--border); border-radius: 12px; background: var(--bg-card); color: var(--text); font-size: 14px; cursor: pointer;">
                    Abbrechen
                </button>
                <button type="button" onclick="BoatOS.confirmStartTrip()" style="flex: 1; padding: 14px; border: none; border-radius: 12px; background: var(--success); color: white; font-size: 14px; font-weight: 600; cursor: pointer;">
                    üö¢ Fahrt starten
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================
         SEARCH OVERLAY
         ============================================ -->
    <div class="search-overlay" id="searchOverlay" onclick="BoatOS.ui.closeSearch(event)">
        <div class="search-container" onclick="event.stopPropagation()">
            <div class="search-input-wrapper">
                <span style="font-size: 20px;">üîç</span>
                <input type="text" class="search-input" id="searchInput" placeholder="Hafen, Marina, Schleuse..." oninput="BoatOS.ui.handleSearch(this.value)">
                <button class="icon-btn" style="width: 32px; height: 32px;" onclick="BoatOS.ui.closeSearch()">‚úï</button>
            </div>
            <div class="search-results" id="searchResults">
                <!-- Search results loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- ============================================
         SETTINGS SIDEBAR
         ============================================ -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="BoatOS.ui.toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>‚öôÔ∏è Einstellungen</h3>
            <button class="icon-btn" style="width: 36px; height: 36px;" onclick="BoatOS.ui.toggleSidebar()">‚úï</button>
        </div>

        <div class="sidebar-tabs">
            <div class="sidebar-tab active" onclick="BoatOS.ui.showSettingsTab('general', this)">Allgemein</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('boat', this)">Boot</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('map', this)">Karte</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('nav', this)">Navigation</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('ais', this)">AIS</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('charts', this)">Seekarten</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('gps', this)">GPS</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('data', this)">Daten</div>
            <div class="sidebar-tab" onclick="BoatOS.ui.showSettingsTab('routing', this)">Routing</div>
        </div>

        <div class="sidebar-content">
            <!-- General Settings -->
            <div id="settings-general">
                <div class="setting-group">
                    <h4>Anzeige</h4>
                    <div class="setting-item">
                        <span>Dark Mode</span>
                        <div class="toggle" id="toggle-darkmode" onclick="BoatOS.ui.toggleSettingToggle(this, 'darkMode')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Sprache</span>
                        <select class="setting-select" id="setting-language">
                            <option value="de">Deutsch</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Einheiten</h4>
                    <div class="setting-item">
                        <span>Geschwindigkeit</span>
                        <select class="setting-select" id="setting-speed-unit">
                            <option value="kn">Knoten (kn)</option>
                            <option value="kmh">km/h</option>
                            <option value="mph">mph</option>
                            <option value="ms">m/s</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>Distanz</span>
                        <select class="setting-select" id="setting-distance-unit">
                            <option value="nm">Nautische Meilen (NM)</option>
                            <option value="km">Kilometer (km)</option>
                            <option value="mi">Meilen (mi)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>Tiefe</span>
                        <select class="setting-select" id="setting-depth-unit">
                            <option value="m">Meter (m)</option>
                            <option value="ft">Fu√ü (ft)</option>
                            <option value="fathom">Faden</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>Temperatur</span>
                        <select class="setting-select" id="setting-temperature-unit">
                            <option value="c">Celsius (¬∞C)</option>
                            <option value="f">Fahrenheit (¬∞F)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>Luftdruck</span>
                        <select class="setting-select" id="setting-pressure-unit">
                            <option value="hpa">hPa</option>
                            <option value="mbar">mbar</option>
                            <option value="inhg">inHg</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>Volumen</span>
                        <select class="setting-select" id="setting-volume-unit">
                            <option value="l">Liter (L)</option>
                            <option value="gal">Gallonen (gal)</option>
                        </select>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Formate</h4>
                    <div class="setting-item">
                        <span>Koordinaten</span>
                        <select class="setting-select" id="setting-coordinate-format">
                            <option value="decimal">Dezimal (51.6162)</option>
                            <option value="dm">Grad/Min (51¬∞ 36.97')</option>
                            <option value="dms">Grad/Min/Sek (51¬∞ 36' 58")</option>
                        </select>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>T√∂ne</h4>
                    <div class="setting-item">
                        <span>Alarme</span>
                        <div class="toggle active" id="toggle-alarms" onclick="BoatOS.ui.toggleSettingToggle(this, 'alarms')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Benachrichtigungen</span>
                        <div class="toggle active" id="toggle-notifications" onclick="BoatOS.ui.toggleSettingToggle(this, 'notifications')"></div>
                    </div>
                </div>
            </div>

            <!-- Boat Settings -->
            <div id="settings-boat" class="section-hidden">
                <div class="setting-group">
                    <h4>Bootsdaten</h4>
                    <div class="setting-item">
                        <span>Name</span>
                        <input type="text" class="setting-input" id="setting-boat-name" value="Arielle" style="width: 120px;">
                    </div>
                    <div class="setting-item">
                        <span>Bootstyp</span>
                        <select class="setting-input" id="setting-boat-type" style="width: 140px;">
                            <option value="motorboat">Motorboot</option>
                            <option value="sailboat">Segelboot</option>
                            <option value="yacht">Yacht</option>
                            <option value="cabin_cruiser">Kabinenkreuzer</option>
                            <option value="houseboat">Hausboot</option>
                            <option value="other">Sonstiges</option>
                        </select>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Abmessungen</h4>
                    <div class="setting-item">
                        <span>L√§nge (m)</span>
                        <input type="number" class="setting-input" id="setting-boat-length" value="12.5" step="0.1" min="0">
                    </div>
                    <div class="setting-item">
                        <span>Breite (m)</span>
                        <input type="number" class="setting-input" id="setting-boat-beam" value="3.8" step="0.1" min="0">
                    </div>
                    <div class="setting-item">
                        <span>Tiefgang (m)</span>
                        <input type="number" class="setting-input" id="setting-boat-draft" value="1.2" step="0.1" min="0">
                    </div>
                    <div class="setting-item">
                        <span>H√∂he (m)</span>
                        <input type="number" class="setting-input" id="setting-boat-height" value="4.5" step="0.1" min="0">
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Tank & Verbrauch</h4>
                    <div class="setting-item">
                        <span>Tankinhalt (L)</span>
                        <input type="number" class="setting-input" id="setting-boat-fuel-capacity" value="200" step="1" min="0">
                    </div>
                    <div class="setting-item">
                        <span>Verbrauch (L/h)</span>
                        <input type="number" class="setting-input" id="setting-boat-fuel-consumption" value="8.5" step="0.1" min="0">
                    </div>
                    <div class="setting-item">
                        <span>Reisegeschw. (km/h)</span>
                        <input type="number" class="setting-input" id="setting-boat-cruise-speed" value="15" step="0.5" min="0">
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Boot-Symbol</h4>
                    <div class="boat-icons" id="boatIcons">
                        <div class="boat-icon-option active" data-icon="motorboat" onclick="BoatOS.ui.selectBoatIcon(this)">üö§</div>
                        <div class="boat-icon-option" data-icon="sailboat" onclick="BoatOS.ui.selectBoatIcon(this)">‚õµ</div>
                        <div class="boat-icon-option" data-icon="yacht" onclick="BoatOS.ui.selectBoatIcon(this)">üõ•Ô∏è</div>
                        <div class="boat-icon-option" data-icon="ship" onclick="BoatOS.ui.selectBoatIcon(this)">üö¢</div>
                    </div>
                </div>

                <div class="setting-group" style="background: rgba(52, 152, 219, 0.1); padding: 12px; border-radius: 8px;">
                    <p style="font-size: 12px; color: var(--text-dim); margin: 0; line-height: 1.5;">
                        <strong style="color: var(--accent);">Routing-Info:</strong><br>
                        Tiefgang, H√∂he und Breite werden f√ºr die Routenplanung verwendet um flache Gew√§sser, niedrige Br√ºcken und enge Kan√§le zu vermeiden.
                    </p>
                </div>
            </div>

            <!-- Map Settings -->
            <div id="settings-map" class="section-hidden">
                <div class="setting-group">
                    <h4>Kartenlayer</h4>
                    <div class="setting-item">
                        <span>OpenSeaMap</span>
                        <div class="toggle active" id="toggle-openseamap" onclick="BoatOS.ui.toggleSettingToggle(this, 'openSeaMap')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Schleusen anzeigen</span>
                        <div class="toggle active" id="toggle-locks" onclick="BoatOS.ui.toggleSettingToggle(this, 'showLocks')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Pegelst√§nde anzeigen</span>
                        <div class="toggle" id="toggle-pegel" onclick="BoatOS.ui.toggleSettingToggle(this, 'showPegel')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Track anzeigen</span>
                        <div class="toggle active" id="toggle-track" onclick="BoatOS.ui.toggleSettingToggle(this, 'showTrack')"></div>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Verhalten</h4>
                    <div class="setting-item">
                        <span>Auto-Zentrierung</span>
                        <div class="toggle active" id="toggle-autocenter" onclick="BoatOS.ui.toggleSettingToggle(this, 'autoCenter')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Heading Up</span>
                        <div class="toggle" id="toggle-headingup" onclick="BoatOS.ui.toggleSettingToggle(this, 'headingUp')"></div>
                    </div>
                </div>
            </div>

            <!-- Navigation Settings -->
            <div id="settings-nav" class="section-hidden">
                <div class="setting-group">
                    <h4>Routing</h4>
                    <div class="setting-item">
                        <span>Wasserwege bevorzugen</span>
                        <div class="toggle active" id="toggle-waterways" onclick="BoatOS.ui.toggleSettingToggle(this, 'preferWaterways')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Standard-Geschwindigkeit</span>
                        <input type="number" class="setting-input" id="setting-default-speed" value="6" step="0.5"> <span class="unit-speed">kn</span>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Alarme</h4>
                    <div class="setting-item">
                        <span>Ankunftsalarm</span>
                        <div class="toggle active" id="toggle-arrival-alarm" onclick="BoatOS.ui.toggleSettingToggle(this, 'arrivalAlarm')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Alarm-Distanz</span>
                        <input type="number" class="setting-input" id="setting-alarm-distance" value="0.1" step="0.05"> <span id="setting-alarm-dist-unit" class="unit-distance">NM</span>
                    </div>
                </div>
            </div>

            <!-- AIS Settings -->
            <div id="settings-ais" class="section-hidden">
                <div class="setting-group">
                    <h4>AIS Empfang</h4>
                    <div class="setting-item">
                        <span>AIS aktiviert</span>
                        <div class="toggle" id="toggle-ais" onclick="BoatOS.ui.toggleSettingToggle(this, 'aisEnabled')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Anbieter</span>
                        <select class="setting-input" id="setting-ais-provider">
                            <option value="aisstream">AISstream</option>
                            <option value="aishub">AISHub</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>API-Key</span>
                        <input type="text" class="setting-input" id="setting-ais-apikey" placeholder="API-Key eingeben">
                    </div>
                    <div class="setting-item">
                        <span>Reichweite</span>
                        <input type="number" class="setting-input" id="setting-ais-range" value="20"> <span id="setting-ais-range-unit" class="unit-distance">NM</span>
                    </div>
                    <div class="setting-item">
                        <span>Update-Intervall (Sek.)</span>
                        <input type="number" class="setting-input" id="setting-ais-interval" value="60" min="10" max="300" step="10">
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Anzeige</h4>
                    <div class="setting-item">
                        <span>Schiffsnamen anzeigen</span>
                        <div class="toggle active" id="toggle-ais-labels" onclick="BoatOS.ui.toggleSettingToggle(this, 'aisLabels')"></div>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>Kollisionswarnung</h4>
                    <div class="setting-item">
                        <span>CPA Alarm</span>
                        <div class="toggle active" id="toggle-cpa" onclick="BoatOS.ui.toggleSettingToggle(this, 'cpaAlarm')"></div>
                    </div>
                    <div class="setting-item">
                        <span>Min. CPA</span>
                        <input type="number" class="setting-input" id="setting-min-cpa" value="0.5" step="0.1"> <span id="setting-cpa-unit" class="unit-distance">NM</span>
                    </div>
                </div>
            </div>

            <!-- Charts/Seekarten Settings -->
            <div id="settings-charts" class="section-hidden">
                <div class="setting-group">
                    <h4>Installierte Seekarten</h4>
                    <div id="charts-list" style="max-height: 250px; overflow-y: auto; background: rgba(42, 82, 152, 0.1); padding: 15px; border-radius: 8px;">
                        <div style="color: #8892b0; text-align: center; padding: 20px;">Keine Karten installiert</div>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>ELWIS ENC herunterladen</h4>
                    <p style="font-size: 12px; color: #8892b0; margin-bottom: 10px;">Offizielle Binnenschifffahrtskarten von ELWIS</p>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                        <button onclick="loadENCCatalog()" class="btn-secondary" style="flex: 1; min-width: 100px;">Katalog laden</button>
                        <button onclick="selectAllENC()" class="btn-secondary" style="flex: 0;">Alle</button>
                        <button onclick="deselectAllENC()" class="btn-secondary" style="flex: 0;">Keine</button>
                    </div>
                    <div id="enc-catalog-list" style="max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="color: #8892b0; text-align: center; padding: 20px;">Klicke "Katalog laden" um verf√ºgbare ENC anzuzeigen</div>
                    </div>
                    <button onclick="downloadSelectedENC()" id="download-enc-btn" disabled class="btn-primary" style="width: 100%;">Ausgew√§hlte herunterladen</button>
                    <div id="enc-download-status" style="margin-top: 10px; font-size: 12px; color: #64ffda; text-align: center;"></div>
                </div>

                <div class="setting-group">
                    <h4>Karte hochladen</h4>
                    <p style="font-size: 12px; color: #8892b0; margin-bottom: 10px;">KAP, ENC (.000), ZIP, MBTiles, GeoTIFF</p>
                    <input type="file" id="chart-file-input" accept=".kap,.zip,.mbtiles,.tif,.tiff,.000" multiple style="display: none;" onchange="updateFileInfo()">
                    <input type="file" id="chart-folder-input" accept=".kap,.zip,.mbtiles,.tif,.tiff,.000" webkitdirectory directory multiple style="display: none;" onchange="updateFileInfo()">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button onclick="document.getElementById('chart-file-input').click()" class="btn-secondary" style="flex: 1;">Dateien</button>
                        <button onclick="document.getElementById('chart-folder-input').click()" class="btn-secondary" style="flex: 1;">Ordner</button>
                    </div>
                    <div id="selected-files-info" style="font-size: 12px; color: #64ffda; margin-bottom: 10px; min-height: 18px;"></div>
                    <input type="text" id="chart-name-input" placeholder="Karten-Name (optional)" class="setting-input" style="width: 100%; margin-bottom: 10px;">
                    <button onclick="uploadChart()" class="btn-primary" style="width: 100%;">Hochladen</button>
                </div>
            </div>

            <!-- GPS Settings -->
            <div id="settings-gps" class="section-hidden">
                <div class="setting-group">
                    <h4>SignalK Server</h4>
                    <div class="setting-item">
                        <span>Server URL</span>
                        <input type="text" class="setting-input" id="setting-signalk-url" value="http://localhost:3000" placeholder="http://localhost:3000" style="width: 100%;">
                    </div>
                    <small style="color: var(--text-dim); font-size: 11px; display: block; margin-top: 5px;">
                        Adresse des SignalK-Servers f√ºr Sensordaten
                    </small>
                </div>

                <div class="setting-group">
                    <h4>GPS-Status Einstellungen</h4>
                    <div class="setting-item">
                        <span>Wartezeit bei wenig Satelliten</span>
                        <input type="number" class="setting-input" id="setting-low-satellite-threshold" min="5" max="60" value="15" step="5"> Sek.
                    </div>
                    <small style="color: var(--text-dim); font-size: 11px; display: block; margin-top: 5px;">
                        Zeit (in Sekunden), die weniger als 4 Satelliten empfangen werden m√ºssen, bevor der Status auf "Wenig Satelliten" wechselt.
                    </small>
                </div>

                <div class="setting-group">
                    <h4>GPS-Quelle</h4>
                    <div class="setting-item">
                        <span>Datenquelle</span>
                        <select class="setting-select" id="setting-gps-source">
                            <option value="signalk">SignalK Server</option>
                            <option value="gpsd">GPSD</option>
                            <option value="browser">Browser GPS</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Data Management Settings -->
            <div id="settings-data" class="section-hidden">
                <div class="setting-group">
                    <h4>Daten-Verwaltung</h4>
                    <div class="setting-item">
                        <button onclick="BoatOS.settings.exportSettings()" class="btn-secondary" style="width: 100%;">
                            üì• Einstellungen exportieren
                        </button>
                    </div>
                    <div class="setting-item">
                        <button onclick="BoatOS.settings.importSettings()" class="btn-secondary" style="width: 100%;">
                            üì§ Einstellungen importieren
                        </button>
                    </div>
                    <div class="setting-item">
                        <button onclick="BoatOS.settings.resetSettings()" class="btn-secondary" style="width: 100%; background: var(--warning);">
                            üîÑ Auf Standardwerte zur√ºcksetzen
                        </button>
                    </div>
                </div>

                <div class="setting-group">
                    <h4>üóÑÔ∏è Schleusen-Datenbank</h4>
                    <small style="color: var(--text-dim); display: block; margin-bottom: 15px;">
                        Verwalte die Schleusen-Datenbank: OSM-Import, Datenanreicherung und Qualit√§tspr√ºfung.
                    </small>

                    <div class="setting-item">
                        <button onclick="BoatOS.settings.importLocksFromOSM()" class="btn-primary" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            üåç Schleusen von OSM importieren
                        </button>
                        <small style="color: var(--text-dim); display: block; margin-top: 5px;">
                            L√§dt neue Schleusen aus OpenStreetMap in die Datenbank
                        </small>
                    </div>

                    <div class="setting-item">
                        <button onclick="BoatOS.settings.enrichLocksData()" class="btn-primary" style="width: 100%; background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);">
                            ‚ú® Daten anreichern
                        </button>
                        <small style="color: var(--text-dim); display: block; margin-top: 5px;">
                            Erg√§nzt VHF-Kan√§le, Kontaktdaten und weitere Infos
                        </small>
                    </div>

                    <div class="setting-item">
                        <button onclick="BoatOS.settings.checkLocksQuality()" class="btn-primary" style="width: 100%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            üìä Qualit√§tsbericht anzeigen
                        </button>
                        <small style="color: var(--text-dim); display: block; margin-top: 5px;">
                            Zeigt Statistiken zur Datenqualit√§t (VHF-Abdeckung, Kontakte, etc.)
                        </small>
                    </div>

                    <div class="setting-item">
                        <button onclick="BoatOS.settings.verifyLocksPositions()" class="btn-primary" style="width: 100%; background: linear-gradient(135deg, #f5576c 0%, #fc6c85 100%);">
                            üìç Positionen √ºberpr√ºfen & korrigieren
                        </button>
                        <small style="color: var(--text-dim); display: block; margin-top: 5px;">
                            Pr√ºft alle Schleusen-Positionen gegen OpenStreetMap und korrigiert Fehler (>500m Abweichung)
                        </small>
                    </div>

                    <div id="locks-quality-report" style="display: none; margin-top: 15px; padding: 15px; background: var(--bg-card); border-radius: 8px; border: 1px solid var(--accent);">
                        <h4 style="margin: 0 0 10px 0; color: var(--accent);">üìä Datenqualit√§t</h4>
                        <pre id="locks-quality-content" style="color: var(--text-dim); font-size: 11px; line-height: 1.6; overflow-x: auto; white-space: pre-wrap; margin: 0;"></pre>
                    </div>
                </div>
            </div>

            <!-- Routing Settings -->
            <div id="settings-routing" class="section-hidden">
                <div class="setting-group">
                    <h4>Routing-Methode</h4>
                    <div class="setting-item">
                        <span>Anbieter</span>
                        <select class="setting-select" id="setting-routing-provider" onchange="BoatOS.settings.updateRoutingProviderVisibility()">
                            <option value="osrm">OSRM (Lokal, Offline)</option>
                            <option value="graphhopper">GraphHopper (Cloud API)</option>
                            <option value="direct">Direkte Linie (Rhumbline)</option>
                        </select>
                    </div>
                </div>

                <div class="setting-group" id="osrm-settings">
                    <h4>OSRM Server</h4>
                    <div class="setting-item">
                        <span>Server-URL</span>
                        <input type="text" class="setting-input" id="setting-osrm-url" value="http://localhost:5000" placeholder="http://localhost:5000" style="width: 100%;">
                    </div>
                    <div class="setting-item">
                        <span>Aktuelle Region</span>
                        <div id="current-region-display" style="padding: 8px 12px; background: var(--bg-card); border-radius: 6px; color: var(--accent); font-weight: 600;">
                            <span id="current-region-name">--</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <span>Region wechseln</span>
                        <select class="setting-select" id="region-selector">
                            <option value="">Region w√§hlen...</option>
                        </select>
                    </div>
                    <button onclick="BoatOS.settings.switchOSRMRegion()" class="btn-primary" style="width: 100%; margin-top: 10px;">
                        üîÑ Region wechseln
                    </button>
                    <div id="region-switch-status" style="margin-top: 10px; padding: 10px; border-radius: 6px; font-size: 12px; display: none;"></div>
                </div>

                <div class="setting-group" id="graphhopper-settings" style="display: none;">
                    <h4>GraphHopper</h4>
                    <div class="setting-item">
                        <span>API-Key</span>
                        <input type="text" class="setting-input" id="setting-graphhopper-api-key" placeholder="Kostenlos auf graphhopper.com" style="width: 100%;">
                    </div>
                    <small style="color: var(--text-dim); font-size: 11px;">
                        üîó API-Key bei graphhopper.com registrieren (500 Anfragen/Tag kostenlos)
                    </small>
                </div>

                <div class="setting-group">
                    <h4>üåä Flie√ügeschwindigkeiten</h4>
                    <div class="setting-item">
                        <span>Str√∂mung ber√ºcksichtigen</span>
                        <div class="toggle" id="toggle-water-current" onclick="BoatOS.ui.toggleSettingToggle(this, 'waterCurrentEnabled')"></div>
                    </div>
                    <small style="color: var(--text-dim); font-size: 11px; display: block; margin-bottom: 15px;">
                        Ber√ºcksichtigt Flie√ügeschwindigkeiten f√ºr genauere ETA-Berechnungen
                    </small>

                    <div id="water-current-settings">
                        <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5 style="margin: 0 0 10px 0; color: var(--accent);">Gew√§sser-spezifisch (<span class="unit-speed">kn</span>)</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Rhein</span>
                                    <input type="number" class="setting-input" id="setting-current-rhein" value="3.2" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Mosel</span>
                                    <input type="number" class="setting-input" id="setting-current-mosel" value="1.6" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Main</span>
                                    <input type="number" class="setting-input" id="setting-current-main" value="1.3" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Elbe</span>
                                    <input type="number" class="setting-input" id="setting-current-elbe" value="2.2" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Saale</span>
                                    <input type="number" class="setting-input" id="setting-current-saale" value="1.1" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Donau</span>
                                    <input type="number" class="setting-input" id="setting-current-donau" value="2.7" step="0.1" min="0" style="width: 70px;">
                                </div>
                            </div>
                        </div>

                        <div style="background: var(--bg-card); padding: 15px; border-radius: 8px;">
                            <h5 style="margin: 0 0 10px 0; color: var(--accent);">Standard nach Typ (<span class="unit-speed">kn</span>)</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Fluss</span>
                                    <input type="number" class="setting-input" id="setting-current-type-river" value="1.1" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Kanal</span>
                                    <input type="number" class="setting-input" id="setting-current-type-canal" value="0.0" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">Bach</span>
                                    <input type="number" class="setting-input" id="setting-current-type-stream" value="0.5" step="0.1" min="0" style="width: 70px;">
                                </div>
                                <div class="setting-item" style="margin: 0;">
                                    <span style="font-size: 12px;">See</span>
                                    <input type="number" class="setting-input" id="setting-current-type-lake" value="0.0" step="0.1" min="0" style="width: 70px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 15px; padding: 12px; background: rgba(100, 200, 100, 0.1); border-radius: 8px; font-size: 11px; color: var(--text-dim);">
                        <strong>‚ÑπÔ∏è Berechnung:</strong><br>
                        ‚Ä¢ Stromabw√§rts: Geschwindigkeit + Str√∂mung<br>
                        ‚Ä¢ Stromaufw√§rts: Geschwindigkeit - Str√∂mung<br>
                        ‚Ä¢ Live-Daten von PEGELONLINE (falls verf√ºgbar)
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="sidebar-btn secondary" onclick="BoatOS.ui.toggleSidebar()">Abbrechen</button>
            <button class="sidebar-btn primary" onclick="BoatOS.saveAllSettings()">Speichern</button>
        </div>
    </div>

    <!-- ============================================
         DASHBOARD EDITOR (Fullscreen)
         ============================================ -->
    <div class="dashboard-editor-overlay" id="dashboardEditorOverlay" style="
        display: none;
        position: fixed;
        inset: 0;
        background: var(--bg-main);
        z-index: 5000;
        flex-direction: column;
    ">
        <!-- Editor Header -->
        <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
        ">
            <h2 style="margin: 0; font-size: 20px; color: var(--accent);">
                ‚úèÔ∏è Dashboard Editor
            </h2>
            <div style="display: flex; gap: 10px;">
                <button onclick="BoatOS.saveDashboardLayout()" style="
                    padding: 10px 20px;
                    background: var(--success);
                    color: white;
                    border: none;
                    border-radius: 10px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                ">üíæ Speichern</button>
                <button onclick="BoatOS.closeDashboardEditor()" style="
                    padding: 10px 20px;
                    background: var(--bg-card);
                    color: var(--text);
                    border: 1px solid var(--border);
                    border-radius: 10px;
                    font-size: 14px;
                    cursor: pointer;
                ">‚úï Schlie√üen</button>
            </div>
        </div>

        <!-- Editor Content -->
        <div id="dashboardEditorContent" style="
            flex: 1;
            overflow: hidden;
            padding: 20px;
        ">
            <!-- Visual Editor will be rendered here -->
        </div>
    </div>

    <!-- ============================================
         JAVASCRIPT MODULES
         ============================================ -->
    <script src="dashboard_renderer.js"></script>
    <script src="js/dashboard-editor.js"></script>
    <script src="locks.js"></script>
    <script src="charts.js"></script>
    <script type="module" src="js/main.js"></script>

    <!-- LEGACY SUPPORT: Old inline code removed, now in js/main.js, js/logbook.js, js/settings.js
         TODO: Remove this comment block after testing

         Previous inline script moved to:
         - js/main.js - Main entry point, initialization, unit system
         - js/logbook.js - Trip management, log entries, archive
         - js/settings.js - Settings save/load functions
    -->

    <!-- Chart Progress Modal -->
    <div id="chart-progress-modal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 20000; justify-content: center; align-items: center;">
        <div style="background: var(--bg-panel); padding: 30px; border-radius: 16px; max-width: 500px; width: 90%; border: 2px solid var(--accent);">
            <h2 id="progress-title" style="margin-bottom: 20px; color: var(--accent); text-align: center;">Verarbeite Karten...</h2>
            <div id="progress-status" style="color: var(--text-dim); margin-bottom: 15px; font-size: 14px; min-height: 20px; text-align: center;">Initialisiere...</div>
            <div style="background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin-bottom: 15px;">
                <div id="progress-bar" style="background: linear-gradient(90deg, var(--accent), #2ecc71); height: 24px; width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; color: #0a192f;">0%</div>
            </div>
            <pre id="progress-details" style="max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; font-size: 11px; color: var(--text-dim); display: none;"></pre>
            <button id="progress-close-btn" onclick="closeProgressModal()" style="display: none; margin-top: 15px; width: 100%; padding: 12px; background: var(--accent); border: none; border-radius: 8px; color: #0a192f; font-weight: 600; cursor: pointer;">Schlie√üen</button>
        </div>
    </div>

</body>
</html>
